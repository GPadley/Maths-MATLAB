\documentclass[10pt,a4paper]{article}
\usepackage[top=0in, bottom=0.5in,margin=1in, includefoot]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\date{}
\author{}
\setlength\parindent{0pt}
\usepackage{amsmath}
\usepackage{wrapfig}
\usepackage{graphicx}
\usepackage{lineno}
\usepackage{layout}
\setlength{\voffset}{-0.4in}
\textheight = 735pt
\begin{document}
\vspace{-20mm}
\title{\textbf{EE2-08C Numerical Analysis} \\ Group 9\vspace{-17mm}}
\maketitle


\section*{Exercise 3}\vspace{-1mm}

\begin{wrapfigure}{r}{0.5\textwidth}
\vspace{-10mm}
  		\includegraphics[width=0.49\textwidth]{Ex3_Figs/RLC.png}
\vspace{-6mm}
  	\caption{RLC Circuit}
  	\label{fig:RLC}
\end{wrapfigure}

From Kirchoff's Voltage Law (KVL) the sum of all the voltages in a closed loop must sum to 0 V. Therefore from this we can derive the equation $V_{in}(t) = v_L(t)+v_R(t)+v_C(t)$. All of the voltages in the closed loop current which flows through them, all being equal to the inductor current. The voltage across a conductor is the inductance multiplied by the derivative of it's current, the voltage across the resistor is equal to it's resistance multiplied by the current travelling through it and the voltage across the capacitor is the charge held within the capacitor divided by the capacitance of the capacitor. Substituting these characteristics into the equation above gives us the equation:

\[ L \frac{d}{dt}i_L(t) + R i_L(t) + \frac{1}{C}\int\limits_0^t i_L(t) \ dt = V_{in}(t)\]

Substituting $i_L(t)$ for $\frac{d}{dt}q_C(t)$ you make the equation:

\[ L \frac{d^2}{dt^2}q_C(t) + R\frac{d}{dt}q_C(t) + \frac{1}{C}q_C(t) = V_{in}(t)\]

We were then able to turn this second order ODE into a set of 2 coupled first order ODEs through the use of equating $q_C'(t)$ = $y(t)$ and substituting $q_C(t)$ for $x(t)$ we have the coupled equations:

\[y(t) = x'(t) \text{\hspace{5mm}and \hspace{5mm}}y'(t) = \frac{1}{L}[V_{in}(t)  - Ry(t) - \frac{1}{C}x(t)] \]

For our project we have values:

\[R = 250 \Omega, C = 3 \mu F , L = 650 mH, i_L(0) = 0 \hspace{2mm} (y_0) \text{\hspace{2mm}and\hspace{2mm}} q_C(0) = 500nC \hspace{2mm} (x_0).\]

Now that we have these two equations we are able to implement them into MATLAB scripf called 'RLC\_script.m` by defining them as:

\begin{verbatim}
R = 250; L = 650*10^-3; C = 3*10^-6; %Impedance values for the components
w1 = 2*pi*500; %frequency for the 500 Hz sinusoid
w2 = 2*pi*100; %frequency for the sinusoid
w3 = 2*pi*5; %frequency for the sinusoid
tc = 3*10^-6; %tau for the exponential decay input
y0 = 0; x0 = 500*10^-9; t0 = 0; %Initial conditions y = iL, x =qC and t = time
h = 0.00001; %step size
tf = 0.03; %final condition
Vin = @(t) 5;
func1 = @(x, y, t) y; %y = q'
func2 = @(x, y, t) (Vin(t) - R*y - x/C)/L; %the second coupled equation
\end{verbatim}

To now evaluate these coupled equations, we use the Runge Kutta 4th order 3/8 algorithm to use these two coupled equations to estimate the next point of the current $i_L$ and the charge $q_C$. The algorithm is:

\[f_1(x,y,t) = y \hspace{3mm} f_2(x,y,z) = \frac{1}{L}[V_{in}(t) - Ry - \frac{x}{C}]\]
\[k1_x = hf_1(x_i,y_i,t_i) \hspace{3mm} k1_y = hf_2(x_i,y_i,t_i)\]
\[k2_x = hf_1(x_i+\frac{k1_x}{3},y_i+\frac{k1_y}{3},t_i+\frac{h}{3}) \]
\[k2_y = hf_2(x_i+\frac{k1_x}{3},y_i+\frac{k1_y}{3},t_i+\frac{h}{3})\]
\[k3_x = hf_1(x_i-\frac{k1_x}{3}+k2_x,y_i-\frac{k1_y}{3}+k2_y,t_i+\frac{2h}{3}) \]
\[k3_y = hf_2(x_i-\frac{k1_x}{3}+k2_x,y_i-\frac{k1_y}{3}+k2_y,t_i+\frac{2h}{3})\]
\[k4_x = hf_1(x_i+k1_x-k2_x+k3_x,y_ik1_y-k2_y+k3_y,t_i+h) \]
\[k4_y = hf_2(x_i+k1_x-k2_x+k3_x,y_ik1_y-k2_y+k3_y,t_i+h)\]
\[x_{i+1} =x_i+\frac{k1_x+3k2_x+3k3_x+k4_x}{8} \hspace{3mm} y_{i+1} =y_i+\frac{k1_y+3k2_y+3k3_y+k4_y}{8}\]
\[t_{i+1} = t_i + h \hspace{3mm} \text{where h is time step}\]

The way that this works is it

To implement this into MATLAB we created a function called `RK4second.m' in which would take in the two functions and work out the k efficients for both x and y and from there, work out the next position of the x (charge) and y (current) coordinates.

\begin{verbatim}
function [xout, yout] = RK4second (xin, yin, h, tin, func1, func2)

	k1x = h*feval(func1, xin ,yin, tin); %approx the first consts for RK4th ord 3/8 Method
k1y = h*feval(func2, xin ,yin, tin);
	k2x = h*feval(func1, xin + k1x/3, yin + k1y/3, tin+h/3);
	k2y = h*feval(func2, xin + k1x/3, yin + k1y/3, tin+h/3);
	k3x = h*feval(func1, xin  - k1x/3 + k2x, yin - k1y/3 + k2y, tin+2*h/3);
	k3y = h*feval(func2, xin  - k1x/3 + k2x, yin - k1y/3 + k2y, tin+2*h/3);
	k4x = h*feval(func1, xin + k1x - k2x + k3x, yin + k1y - k2y + k3y, tin+h);
k4y = h*feval(func2, xin + k1x - k2x + k3x, yin + k1y - k2y + k3y, tin+h);

	xout = xin + (k1x + 3*k2x + 3*k3x + k4x)/8;
	yout = yin + (k1y + 3*k2y + 3*k3y + k4y)/8;
end
\end{verbatim}

This takes in the present value of current and charge a certain time, the time position, the step time and the two functions to evaluate and approximate the next point, which is then outputted at the end.

\begin{verbatim}
N = round((tf-t0)/h); %calculates number of time steps

ya = zeros(1,N); xa = zeros(1,N);
ta = zeros(1,N); in = zeros(1,N); %set up arrays

xa(1) = x0; ya(1) = y0; ta(1) = t0; in(1) = Vin(t0); %input initial conditions
for i = 1:N-1 %works out next timestep value
	[xa(i+1), ya(i+1)] = RK4second (xa(i), ya(i), h, ta(i),func1, func2);
    ta(i+1) = ta(i) + h; %next time step
    in(i+1) = Vin(ta(i+1)); %next value of the input
end

figure; %sets up the figures
Vout = R*ya; %Vout = R*iL
subplot(2,1,1);
plot(ta, Vout); %plot output Voltage
grid on;
xlabel('Time/s'); ylabel('Voltage Out/V');
title('R*dq/dt with a Step Response')
subplot(2,1,2);
plot(ta, in); %plot input Voltage
grid on;
xlabel('Time/s'); ylabel('Voltage In/V');
title('Step Response')
\end{verbatim}

\begin{wrapfigure}[13]{r}{0.5\textwidth}

	\vspace{-2mm}
  		\includegraphics[width=0.49\textwidth]{Ex3_Figs/Step.png}
	\vspace{-6mm}
  	\caption{$V_{in}(t)= 5$}
  	\label{fig:ex3g1}

\end{wrapfigure}

    \vspace{6mm}The step response causes a sudden rise of voltage up to 5 V, due to the inductor not being able to change current instantaneously the voltage out starts from 0 V and as you can see on Figure 2. It increases up to around 1.8 V at this point the capacitor starts to reduce the rate of it charging up due to saturating in charge, as the voltage out starts to tend to 0, the capacitor emits charge causing a negative current through the inductor. As this goes on, the voltage across the capacitor tends to 5 V causing no current to flow through the inductor and the resistor, causing the output voltage to tend to 0 V.

\begin{wrapfigure}[13]{r!}{0.5\textwidth}
    \vspace{-5mm}

  		\includegraphics[width=0.49\textwidth]{Ex3_Figs/5Sine2.png}
	\vspace{-6mm}
  	\caption{$V_{in}(t)= 5sin(2 \pi 5t)$}
  	\label{fig:ex3g2}

\end{wrapfigure}

\vspace{8mm}In Figure 3 the input is a sine wave of amplitude 5 V and a frequency of 5 Hz, as the sine wave moves away from zero it causes a sharp increase in the current going through the inductor and therefore causes a sharp rise on the voltage out, this then attenuates to form the shape of a sine wave of amplitude is $\approx 0.1 V$ and leads the input voltage by a phase difference of $\frac{\pi}{2}$ this is relative to the frequency of the input and the complex impedance of both the inductor and the capacitor being $j\omega L$ and $\frac{1}{j\omega C}$ respectively. We chose the final time as 0.2 s to show how initially the output changes but then follows the shape of the input eventually.

\begin{wrapfigure}[16]{r}{0.5\textwidth}
    \vspace{-5mm}
  		\includegraphics[width=0.48\textwidth]{Ex3_Figs/100Sine.png}
	\vspace{-6mm}
  	\caption{$V_{in}(t)= 5sin(2 \pi 100t)$}
  	\label{fig:ex3g3}
\end{wrapfigure}
\vspace{10mm}In Figure 4 the input is a sine wave of amplitude 5 V and a frequency of 100 Hz. Upon the start of the wave, the output voltage rises slower than the voltage of the input, due to the fact that the rate of change of the inductor current cannot shange instantaneously and will eventually equal the frequency of the input. This causes a slight phase difference and the amplitude is far greater than the 5 Hz input, resulting in an amplitude of $\approx 4 V$. This greater output voltage is due to being a band pass filter, low frequencies as we can see, 5 Hz for example attenuate to a value close to 0 V whereas at this frequency the output voltage is close to the input voltage and at some frequency greater than this, the same result as the 5 Hz wave will be apparent.

\begin{wrapfigure}{r}{0.5\textwidth}
    \vspace{-7mm}
  		\includegraphics[width=0.48\textwidth]{Ex3_Figs/500Sine.png}
	\vspace{-6mm}
  	\caption{$V_{in}(t)= 5sin(2 \pi 500t)$}
  	\label{fig:ex3g4}
\end{wrapfigure}

\vspace{2mm}In Figure 4 the input is a sine wave of amplitude 5 V and a frequency of 500 Hz. Upon the start of the wave, the output voltage rises slower than the voltage of the input, due to the fact that the rate of change of the inductor current cannot shange instantaneously and will eventually equal the frequency of the input. This causes a slight phase difference and the amplitude is far greater than the 5 Hz input, resulting in an amplitude of $\approx 4 V$. This greater output voltage is due to being a high pass filter, low frequencies as we can see, 5 Hz for example attenuate to a value close to 0 V whereas at this frequency the output voltage is close to the input voltage.
%
% \begin{wrapfigure}{r}{0.5\textwidth}
%   		\includegraphics[width=0.48\textwidth]{Ex3_Figs/5Squ1.png}
% 	\vspace{-6mm}
%   	\caption{$V_{in}(t)= 5square(2 \pi 5t)$}
%   	\label{fig:ex3g5}
% \end{wrapfigure}
%
% sine wave frequency 100 Hz
%
% \begin{wrapfigure}{r}{0.5\textwidth}
%   		\includegraphics[width=0.48\textwidth]{Ex3_Figs/100Squ1.png}
% 	\vspace{-6mm}
%   	\caption{$V_{in}(t)= 5square(2 \pi 100t)$}
%   	\label{fig:ex3g6}
% \end{wrapfigure}
%
% sine wave frequency 100 Hz
%
% \begin{wrapfigure}{r}{0.5\textwidth}
%   		\includegraphics[width=0.48\textwidth]{Ex3_Figs/500Squ1.png}
% 	\vspace{-6mm}
%   	\caption{$V_{in}(t)= 5square(2 \pi 500t)$}
%   	\label{fig:ex3g7}
% \end{wrapfigure}
%
% sine wave frequency 100 Hz
%
% \begin{wrapfigure}{r}{0.5\textwidth}
%   		\includegraphics[width=0.48\textwidth]{Ex3_Figs/DecExp.png}
% 	\vspace{-6mm}
%   	\caption{$V_{in}(t)= 5e^{\frac{-t^2}{\tau_C}}$}
%   	\label{fig:ex3g8}
% \end{wrapfigure}
%
% sine wave frequency 100 Hz

\end{document}
